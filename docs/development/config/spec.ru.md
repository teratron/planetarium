# Config System Specification

## üîç –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ Planetarium –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–µ —á–µ—Ç–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–ª–æ–µ–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Framework/Core) –∏ –∏–≥—Ä–æ–≤—ã–º —Å–ª–æ–µ–º (Game). –û–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É, –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∞ —Ç–∞–∫–∂–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç—è–º–∏ –∫ –¥–∞–Ω–Ω—ã–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **RON (Rusty Object Notation)** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
2. **Platform-Agnostic Paths** ‚Äî –∫–∞—Å—Ç–æ–º–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—É—Ç–µ–π (–±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `dirs`) –¥–ª—è Windows, Linux –∏ macOS.
3. **Reactive Sync** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ—Å—É—Ä—Å–∞—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –¥–≤–∏–∂–∫–∞ (–æ–∫–Ω–æ, –∑–≤—É–∫, —Ç–µ–º–∞) –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫.
4. **Multi-layer Configuration** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø—É—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

---

## üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã (src/config/)

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –≤ –º–æ–¥—É–ª–µ `src/config/` –∏ –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ | –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã/—Ñ—É–Ω–∫—Ü–∏–∏ |
|------|------|------|
| `mod.rs` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ | `setup_config` (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ) |
| `settings.rs` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `UserSettings`, `load_settings`, `save_settings` |
| `paths.rs` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç—è–º–∏ | `AppPaths` (data_dir, assets_dir, log_file) |
| `platform_paths.rs` | OS-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—É—Ç–∏ | `get_data_dir` (Windows, Linux, macOS) |
| `cli.rs` | –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ | `CliArgs` (parse via clap) |
| `metadata.rs` | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | `AppMetadata` (title, version, authors) |
| `validation.rs` | –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | Trait `Validate` –¥–ª—è `DisplaySettings`, `AudioSettings` |

---

## üíæ –§–æ—Ä–º–∞—Ç—ã –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`settings.ron`)

–•—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `%APPDATA%\Planetarium\settings.ron` –Ω–∞ Windows).

```ron
// –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã settings.ron
(
    version: 4,
    language: "en-US",
    theme: "dark",
    display: (
        width: 1920,
        height: 1080,
        fullscreen: false,
        vsync: true,
    ),
    audio: (
        master_volume: 0.8,
        music_volume: 0.7,
        sfx_volume: 1.0,
    ),
    graphics: (
        quality: medium,
    ),
    allow_multiple_instances: false,
)
```

### 2. –ú–∞–Ω–∏—Ñ–µ—Å—Ç –∞—Å—Å–µ—Ç–æ–≤ (`assets.ron`)

–ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø–∞–ø–∫–∏ `assets/`. –°–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏.

---

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª (Bevy)

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (Startup)

–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –¥–≤–∞ —ç—Ç–∞–ø–∞:

- **–í–Ω–µ Bevy (main.rs)**: –†–∞–Ω–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ `AppPaths` –∏ `UserSettings` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `LogPlugin`, `WindowPlugin` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (single-instance lock).
- **–í–Ω—É—Ç—Ä–∏ Bevy**: –†–µ—Å—É—Ä—Å `UserSettings` –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ `App`, —Å—Ç–∞–Ω–æ–≤—è—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º.

### 2. –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (Update)

–í `framework::menu::reactive` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–∏—Å—Ç–µ–º—ã, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `UserSettings`:

- `broadcast_settings_changes`: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä–∞—Ñ–∏–∫–∏ (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, VSync) —Å –¥–µ–±–∞—É–Ω—Å–æ–º –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–µ—Ä—Ü–∞–Ω–∏—è.
- `broadcast_theme_changes`: –û–±–Ω–æ–≤–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ UI –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã.
- `schedule_settings_save` + `auto_save_settings`: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –¥–∏—Å–∫ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∞—Ç–æ–º–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ `.tmp` —Ñ–∞–π–ª).

---

## üõ† –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (CLI)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:

```bash
# –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
planetarium --debug                # –í–∫–ª—é—á–∞–µ—Ç –ª–æ–≥ —É—Ä–æ–≤–Ω—è DEBUG
planetarium --skip-splash          # –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞—Å—Ç–∞–≤–∫—É
planetarium --state InGame         # –ó–∞–ø—É—Å–∫ —Å—Ä–∞–∑—É –≤ –∏–≥—Ä–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
planetarium --log-filter "wgpu=warn" # –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
```

---

## üìã –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

### 1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–∏–≥—Ä–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `SETTINGS_VERSION`. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ `settings::migrate_settings`.

### 2. –ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å (GameplayConfig)

–î–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–∞–ª–∞–Ω—Å–∞ (–º–∞—Å—Å—ã –ø–ª–∞–Ω–µ—Ç, –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã** –≤ `src/game/constants.rs` –¥–ª—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –≤–µ–ª–∏—á–∏–Ω.
- **RON-—Ñ–∞–π–ª—ã** –≤ `assets/configs/gameplay.ron` –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏–∑–∞–π–Ω–µ—Ä–∞–º–∏ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏.

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Secrets**: API-–∫–ª—é—á–∏ (Steam, Discord) –Ω–µ –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ `settings.ron`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è).
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –†–∞—Å—à–∏—Ä–∏—Ç—å `validation.rs` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –≤–≤–æ–¥–∏–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º.

---

## üéØ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

- [ ] –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—è –≤ `UserSettings`: –æ–±–Ω–æ–≤–∏—Ç—å `Default`, `SETTINGS_VERSION` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) –∏ `validation.rs`.
- [ ] –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø—É—Ç–µ–π: –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AppPaths`, –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–∞–∫ —Ä–µ—Å—É—Ä—Å.
- [ ] –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ Config: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `info!("[Config] ...")`.
