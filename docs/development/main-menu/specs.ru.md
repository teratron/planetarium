# Спецификация архитектуры: Модуль Главного Меню (Main Menu)

## Обзор

Главное меню — это основной интерактивный интерфейс игры Planetarium. Оно обеспечивает доступ к игровому процессу, настройкам конфигурации и выходу из приложения. Данный модуль должен обеспечивать качество уровня «AAA» благодаря плавным переходам, реактивным элементам интерфейса и полной поддержке локализации.

## Основные возможности

1. **Главный экран**:
    - Центральное отображение логотипа/названия.
    - Основные действия: **Играть** (Play), **Настройки** (Settings), **Выход** (Exit).
    - Профессиональная звуковая отдача при наведении и клике.
2. **Продвинутая система настроек**:
    - Категоризированный интерфейс: **Графика**, **Звук**, **Управление**, **Общие**.
    - Живая синхронизация с `settings.toml` и внутренними ресурсами движка.
    - Интерактивные слайдеры, переключатели и выпадающие списки.
3. **Локализация (Localization-First)**:
    - Весь текст загружается из файлов Fluent (.ftl).
    - Поддержка переключения языков «на лету» (EN/RU).
4. **Визуальная непрерывность**:
    - Плавные переходы (fading) между главным экраном и окном настроек.
    - Анимации наведения для всех интерактивных элементов.

## Техническая архитектура

### Состояния приложения (AppStates)

Модуль работает преимущественно внутри:

- `AppState::MainMenu`: Главный интерактивный хаб.
- Подсостояния (управляемые через внутренние ресурсы):
  - `SettingsOpen`: Реактивный ресурс для открытия/закрытия оверлея настроек.

### Оркестрация ассетов

Для исправления текущих ошибок модуль реализует:

- **Обнаружение базового пути**: Надежное определение директории `assets/` вне зависимости от текущей рабочей директории (CWD).
- **Embedded Fallbacks**: Критически важные ассеты (шрифты, базовые текстуры кнопок) вшиваются в бинарный файл для обеспечения отказоустойчивости.

### Схема локализации

- **Файл**: `assets/locales/{lang}/text/menu.ftl`
- **Ключи**:
  - `menu-title`: Заголовок игры
  - `menu-play`: Кнопка начала игры
  - `menu-settings`: Кнопка настроек
  - `menu-exit`: Кнопка выхода
  - `settings-title`: Заголовок настроек
  - `tab-graphics`, `tab-audio` и т.д.

### Синхронизация конфигурации

- Интерфейс напрямую привязан к ресурсу `UserSettings`.
- Изменения в UI генерируют событие `SettingChangedEvent`.
- Фоновая система отслеживает эти события для:
    1. Немедленного обновления состояния движка (окно, звук).
    2. Асинхронной записи изменений в `settings.toml`.

## Обработка ошибок и надежность

- **Откат ресурсов**: Если локализованная строка или звук отсутствуют, система откатывается к значениям по умолчанию (English / Розовый квадрат).
- **Безопасность навигации**: Каждое подменю должно иметь кнопку «Назад» и поддержку закрытия по клавише `Esc`.
- **Устойчивость путей**: Использование логики `std::env::current_exe()` для поиска ассетов при прямом запуске.

## Стандарты UI/UX

| Требование | Детали реализации |
| :--- | :--- |
| **Hover FX** | Легкое масштабирование (1.0 -> 1.05), цветовой акцент и звук `hover.ogg`. |
| **Click FX** | Визуальное «вдавливание» и звук `click.ogg`. |
| **Переходы** | Альфа-затухание (300мс) между главным меню и настройками. |
| **High DPI** | Масштабирование на основе `Window::scale_factor()`. |

## Backlog / Будущие задачи

- [ ] Поддержка навигации через геймпад/контроллер.
- [ ] Анимированный 3D-фон за интерфейсом.
- [ ] Эффекты частиц при наведении на кнопки.
